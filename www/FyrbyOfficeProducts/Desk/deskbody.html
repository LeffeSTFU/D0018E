<?php
$servername = "localhost";
$username = "root";
$password = "Fyrby23";
$dbname = "testschema1";

// Create connection
$conn = new mysqli($servername, $username, $password, $dbname);
// Check connection
if ($conn->connect_error) {
  die("Connection failed: " . $conn->connect_error);
}

$sql = "SELECT * FROM `Products` WHERE productCategory=\"Desk Supplies\";";
$result = $conn->query($sql);

if ($result->num_rows > 0) {
  ?>
  <div class="Products-body">
  <?php
    while($row = $result->fetch_assoc())
      {
        $cart = "SELECT * FROM `ShoppingCart` WHERE customerID = '$_SESSION[user_id]' AND productID = '$row[productID]';";
        $checkCart = $conn->query($cart);
        if($checkCart->num_rows == 0) {
          $submission = "INSERT INTO `ShoppingCart` (`productID`,`customerID`, `amount`) 
          VALUES ('$row[productID]', '$_SESSION[user_id]', '1');";
        } else {
          $cartRow = $checkCart->fetch_assoc();
          $newAmount = $cartRow['amount'] + 1;
          $submission = "UPDATE `ShoppingCart` SET `amount` = '$newAmount' WHERE customerID = '$_SESSION[user_id]' AND productID = '$row[productID]';";
        }
  ?>
  <div class="Product-cards">
      <div class="card">
          <div class="card-body">
              <h5 class="card-title">
                  <?php echo $row['productName']; ?>
              </h5>
              <img src="<?php echo $row['imageFile']; ?>" alt="<?php echo $row['imageFile']; ?>" />
              <h6 class="card-stock">
                Stock: <?php echo $row['productStock']; ?>
              </h6>
              <p class="price">
                Price: <?php echo $row["productPrice"]; ?>
              </p>
              <form method="post">
                <button type="submit" name="button1" value="<?php echo $submission; ?>" id="Add_to_cart">add to cart</button>
              </form>
          </div>
      </div><br>
  </div>
  <?php
    }
  ?>
</div>
<?php
} else {
  echo "0 results";
}
if(isset($_POST['button1'])){
  $conn->query($_POST['button1']);
  header("refresh:0");
}
$conn->close();
?>