<?php
session_start();
$servername = "localhost";
$username = "root";
$password = "Fyrby23";
$dbname = "testschema1";

// Create connection
$conn = new mysqli($servername, $username, $password, $dbname);
// Check connection
if ($conn->connect_error) {
  die("Connection failed: " . $conn->connect_error);
}

$usr_id = $_SESSION["user_id"];
$sql = "SELECT Products.*, ShoppingCart.amount FROM Products INNER JOIN ShoppingCart ON Products.productID = ShoppingCart.productID AND ShoppingCart.customerID = '$usr_id';";

$result = $conn->query($sql);

if ($result->num_rows > 0) {
  ?>
  <div class="Products-body">
  <?php
    while($row = $result->fetch_assoc())
      {
        $button1 = "UPDATE ShoppingCart SET amount = amount - 1 WHERE amount > 0 AND customerID = '$usr_id' AND productID = $row[productID];";
        

        /*$button1 = NOWRD();
        function NWORD(){
          $currAmount = SELECT amount FROM ShoppingCart WHERE customerID = '$usr_id' AND productID = $row[productID];
          if($currAmount <= 1){
            DELETE FROM `testschema1`.`ShoppingCart` WHERE customerID = '$usr_id' AND productID = $row[productID];
          }
          else{
            UPDATE ShoppingCart SET amount = amount - 1 WHERE amount > 0 AND customerID = '$usr_id' AND productID = $row[productID];
          }*/
  ?>
  <div class="Product-cards">
      <div class="card">
          <div class="card-body">
              <h5 class="card-title">
                  <?php echo $row['productName']; ?>
              </h5>
              <img src="<?php echo $row['imageFile']; ?>" alt="<?php echo $row['imageFile']; ?>" />
              <h6 class="card-stock">
                Amount: <?php echo $row["amount"]; ?>
              </h6>
              <p class="price">
                Price: <?php echo $row["productPrice"]; ?>
              </p>
              <form method="post">
                <button type="submit" name="button2" value="<?php echo $button1; ?>" id="Remove_from_cart">Remove one from cart</button>
                
              </form>
          </div>
      </div><br>
  </div>
  <?php
    }
  ?>
</div>

<?php
} else {
  echo "0 results";
}
if(isset($_POST['button2'])){
  $conn->query($_POST['button2']);
  header("refresh:0");
  }
$conn->close();
?>